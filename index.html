<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <title>我的世界 - 主世界</title>
    <style>
        body {
            background: #000;
            margin: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .inventory {
            position: fixed;
            top: 80px;
            left: 20px;
            background: rgba(30,30,30,0.95);
            border-radius: 10px;
            padding: 16px 12px;
            z-index: 20;
            min-width: 90px;
            min-height: 60px;
            color: #fff;
            box-shadow: 0 2px 8px #0008;
        }
        .inventory-title {
            font-size: 16px;
            margin-bottom: 10px;
            text-align: center;
            color: #ffd700;
        }
        .inventory-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .inventory-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .inventory-img {
            width: 32px;
            height: 32px;
            object-fit: contain;
            border-radius: 4px;
            background: #222;
            border: 1px solid #444;
        }
        .inventory-count {
            font-size: 16px;
            color: #fff;
            min-width: 24px;
        }
        .center-content {
            text-align: center;
            color: #fff;
        }
        .main-image-container {
            position: relative;
            display: inline-block;
        }
        img.main-img {
            max-width: 100%;
            height: auto;
            display: block;
        }
        .biome-btn {
            position: absolute;
            padding: 8px 16px;
            font-size: 15px;
            border: none;
            border-radius: 6px;
            background: rgba(34,34,34,0.85);
            color: #fff;
            cursor: pointer;
            transition: background 0.2s;
            z-index: 2;
        }
        .biome-btn:hover {
            background: #444;
        }
        .btn-jungle { left: 30%; top: 25%; }
        .btn-ocean { left: 70%; top: 20%; }
        .btn-beach { left: 65%; top: 80%; }
        .btn-snow { left: 30%; top: 50%; }
        .btn-cave { left: 15%; top: 80%; }
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #222;
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            z-index: 10;
            display: none;
        }
        .back-btn.show {
            display: block;
        }
        audio {
            display: none;
        }
        .biome-image-container {
            position: relative;
            display: inline-block;
        }
        .biome-img {
            max-width: 100vw;
            max-height: 60vh;
            display: block;
        }
        .monster-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            z-index: 5;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            pointer-events: auto;
        }
        .monster-img {
            max-width: 180px;
            margin: 0 auto 8px auto;
            display: block;
        }
        .msg-box {
            background: rgba(30,30,30,0.95);
            color: #fff;
            border-radius: 8px;
            padding: 16px 20px;
            margin: 12px auto 0 auto;
            width: fit-content;
            font-size: 18px;
        }
        .battle-btn {
            margin-top: 10px;
            padding: 8px 18px;
            font-size: 16px;
            border: none;
            border-radius: 6px;
            background: #2a5;
            color: #fff;
            cursor: pointer;
        }
        .battle-btn:hover {
            background: #3c7;
        }
        .drop-img {
            max-width: 120px;
            margin: 10px auto 0 auto;
            display: block;
        }
    </style>
</head>
<body>
    <div class="inventory" id="inventoryPanel">
        <div class="inventory-title">物品栏</div>
        <div class="inventory-list" id="inventoryList">
            <!-- 动态生成 -->
        </div>
    </div>
    <button class="back-btn" id="backBtn" onclick="showMain()">返回主世界</button>
    <div class="center-content" id="mainContent">
        <h1>主世界</h1>
        <div class="main-image-container">
            <img src="主世界.png" alt="主世界" class="main-img">
            <button class="biome-btn btn-jungle" onclick="showBiome('丛林')">丛林</button>
            <button class="biome-btn btn-ocean" onclick="showBiome('海洋')">海洋</button>
            <button class="biome-btn btn-beach" onclick="showBiome('沙滩')">沙滩</button>
            <button class="biome-btn btn-snow" onclick="showBiome('雪原')">雪原</button>
            <button class="biome-btn btn-cave" onclick="showBiome('繁茂洞穴')">繁茂洞穴</button>
        </div>
        <audio id="bgm-main" src="Minecraft.ogg" autoplay loop></audio>
    </div>
    <div class="center-content" id="biomeContent" style="display:none;">
        <h1 id="biomeTitle"></h1>
        <div class="biome-image-container" id="biomeImgContainer" style="position:relative;">
            <img id="biomeImg" class="biome-img" src="" alt="" />
            <div id="monsterArea"></div>
        </div>
        <audio id="bgm-biome" src="" loop></audio>
        <audio id="egg-audio" src="Lava_Chicken.ogg" loop></audio>
    </div>
    <script>
        // 各页面图片路径
        const biomeImages = {
            "丛林": "丛林.jpg",
            "海洋": "海洋.png",
            "沙滩": "沙滩.png",
            "雪原": "雪原.png",
            "繁茂洞穴": "繁茂洞穴.png"
        };
        // 各页面音乐路径
        const biomeMusic = {
            "丛林": "Blocks.ogg",
            "海洋": "Far.ogg",
            "沙滩": "Otherside.ogg",
            "雪原": "Where_are_we_now.ogg",
            "繁茂洞穴": "Relic.ogg"
        };
        // 怪物信息
        const monsters = [
            { name: "僵尸", img: "僵尸.png" },
            { name: "骷髅", img: "骷髅.png" },
            { name: "苦力怕", img: "苦力怕.png" },
            { name: "蜘蛛", img: "蜘蛛.png" }
        ];
        // 物品图片（需与物品文件夹实际图片一致）
        const items = [
            "不死图腾.png",
            "彩蛋唱片.png",
            "绿宝石.png",
            "铁锭.png",
            "钻石.png"
            // 可继续添加
        ];

        // 物品栏数据，页面关闭后会重置
        let inventory = {};

        // 停止彩蛋音乐
        function stopEggAudio() {
            const eggAudio = document.getElementById('egg-audio');
            eggAudio.pause();
            eggAudio.currentTime = 0;
        }

        // 增加物品到物品栏
        function addToInventory(itemPath) {
            if (!inventory[itemPath]) {
                inventory[itemPath] = 1;
            } else {
                inventory[itemPath]++;
            }
            updateInventoryPanel();
        }

        // 更新物品栏显示
        function updateInventoryPanel() {
            const list = document.getElementById('inventoryList');
            list.innerHTML = '';
            const itemNames = {
                "不死图腾.png": "不死图腾",
                "彩蛋唱片.png": "彩蛋唱片",
                "绿宝石.png": "绿宝石",
                "铁锭.png": "铁锭",
                "钻石.png": "钻石"
                // 可继续添加
            };
            for (const [img, count] of Object.entries(inventory)) {
                const name = itemNames[img] || '';
                list.innerHTML += `
                    <div class="inventory-item">
                        <img src="${img}" class="inventory-img" alt="${name}">
                        <span class="inventory-count">x${count}</span>
                        <span>${name}</span>
                    </div>
                `;
            }
            if (Object.keys(inventory).length === 0) {
                list.innerHTML = `<div style="color:#888;text-align:center;">暂无物品</div>`;
            }
        }

        function showBiome(name) {
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('biomeContent').style.display = 'block';
            document.getElementById('biomeTitle').textContent = name;
            document.getElementById('biomeImg').src = biomeImages[name];
            document.getElementById('biomeImg').alt = name;
            document.getElementById('backBtn').classList.add('show');
            document.getElementById('monsterArea').innerHTML = '';
            // 主世界音乐暂停
            document.getElementById('bgm-main').pause();
            // 停止彩蛋音乐
            stopEggAudio();
            // 切换并播放对应生物群系音乐
            const biomeAudio = document.getElementById('bgm-biome');
            biomeAudio.src = biomeMusic[name];
            biomeAudio.currentTime = 0;
            biomeAudio.play();

            // 50%概率遇怪
            if (Math.random() < 0.5) {
                const monster = monsters[Math.floor(Math.random() * monsters.length)];
                showMonsterEncounter(monster);
            } else {
                // 未遇怪时有50%概率掉落物品
                if (Math.random() < 0.5 && items.length > 0) {
                    const item = items[Math.floor(Math.random() * items.length)];
                    // 如果是彩蛋唱片，播放Lava_Chicken.ogg
                    if (item.indexOf("彩蛋唱片") !== -1) {
                        document.getElementById('bgm-biome').pause();
                        const eggAudio = document.getElementById('egg-audio');
                        eggAudio.currentTime = 0;
                        eggAudio.play();
                    }
                    addToInventory(item);
                    document.getElementById('monsterArea').innerHTML = `
                        <div class="monster-overlay">
                            <div class="msg-box">您在探索时发现了物品：</div>
                            <img src="${item}" class="drop-img" alt="掉落物品">
                        </div>
                    `;
                }
            }
        }

        function showMonsterEncounter(monster) {
            const area = document.getElementById('monsterArea');
            area.innerHTML = `
                <div class="monster-overlay">
                    <img src="${monster.img}" class="monster-img" alt="${monster.name}">
                    <div class="msg-box">已遭遇${monster.name}，与之战斗。</div>
                    <button class="battle-btn" onclick="battleMonster('${monster.name}', '${monster.img}')">与${monster.name}战斗</button>
                </div>
            `;
        }

        function battleMonster(monsterName, monsterImg) {
            const area = document.getElementById('monsterArea');
            // 50%概率胜利
            if (Math.random() < 0.5) {
                // 胜利
                let dropHtml = '';
                if (Math.random() < 0.5 && items.length > 0) {
                    // 掉落物品
                    const item = items[Math.floor(Math.random() * items.length)];
                    // 如果是彩蛋唱片，播放Lava_Chicken.ogg
                    if (item.indexOf("彩蛋唱片") !== -1) {
                        document.getElementById('bgm-biome').pause();
                        const eggAudio = document.getElementById('egg-audio');
                        eggAudio.currentTime = 0;
                        eggAudio.play();
                    }
                    addToInventory(item);
                    dropHtml = `
                        <div class="monster-overlay">
                            <div class="msg-box">您已战胜${monsterName}，并获得掉落物品：</div>
                            <img src="${item}" class="drop-img" alt="掉落物品">
                        </div>
                    `;
                } else {
                    // 未掉落
                    dropHtml = `
                        <div class="monster-overlay">
                            <div class="msg-box">您已战胜${monsterName}，未掉落任何物品。</div>
                        </div>
                    `;
                }
                area.innerHTML = dropHtml;
            } else {
                // 失败，退回主页面
                alert(`与${monsterName}战斗失败，被击退回主世界！`);
                showMain();
            }
        }

        function showMain() {
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('biomeContent').style.display = 'none';
            document.getElementById('backBtn').classList.remove('show');
            // 停止生物群系音乐
            const biomeAudio = document.getElementById('bgm-biome');
            biomeAudio.pause();
            biomeAudio.currentTime = 0;
            // 停止彩蛋音乐
            stopEggAudio();
            // 播放主世界音乐
            document.getElementById('bgm-main').play();
        }

        // 让battleMonster在全局可用
        window.battleMonster = battleMonster;

        // 初始化物品栏
        updateInventoryPanel();
    </script>
</body>
</html>